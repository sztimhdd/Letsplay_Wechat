<view class="container">
  <!-- 在最顶部添加 -->
  <view class="nav-bar" style="padding-top: {{statusBarHeight}}px">
    <view class="nav-bar-content">
      <view class="back-btn" bindtap="goBack">
        <icon type="download" size="23" color="#fff" style="transform: rotate(90deg);"/>
      </view>
      <view class="title">活动详情</view>
    </view>
  </view>

  <!-- 活动封面图 -->
  <view class="activity-cover">
    <image 
      src="{{activity.coverImage || '../../assets/images/covers/default.png'}}" 
      mode="aspectFill"
      binderror="handleImageError"
      bindtap="previewImage"
      data-url="{{activity.coverImage}}"
    />
  </view>

  <!-- 活动基本信息 -->
  <view class="activity-info">
    <view class="title">{{activity.title}}</view>
    <view class="price-members">
      <view class="price">¥{{activity.price}}/人</view>
      <view class="members">{{activity.currentMembers}}/{{activity.maxMembers}}人</view>
    </view>

    <!-- 活动详细信息 -->
    <view class="info-list">
      <view class="info-item">
        <icon type="waiting" size="16" color="#666"/>
        <text>{{activity.date}} {{activity.startTime}}-{{activity.endTime}}</text>
      </view>
      <view class="info-item">
        <icon type="location" size="16" color="#666"/>
        <text>{{activity.location}}</text>
      </view>
      <view class="info-item">
        <icon type="contact" size="16" color="#666"/>
        <text>发起人：{{activity.organizer}}</text>
      </view>
    </view>

    <!-- 活动描述 -->
    <view class="description">
      <view class="section-title">活动说明</view>
      <text>{{activity.description || '暂无活动说明'}}</text>
    </view>

    <!-- 参与者列表 -->
    <view class="participants">
      <view class="section-title">参与者 ({{activity.currentMembers}}人)</view>
      <scroll-view class="avatar-list" scroll-x>
        <view class="avatar-item" 
          wx:for="{{activity.participants}}" 
          wx:key="id"
          bindtap="viewUserProfile"
          data-userid="{{item.id}}"
        >
          <image 
            src="{{item.avatar}}" 
            mode="aspectFill"
            binderror="handleImageError"
            data-type="avatar"
            data-index="{{index}}"
          />
          <text>{{item.name}}</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="bottom-bar">
    <view class="share-btn">
      <button open-type="share" plain>
        <icon type="share" size="14" color="#666"/>
        <text>分享</text>
      </button>
    </view>
    
    <!-- 已结束的活动 -->
    <block wx:if="{{activity.status === 'completed'}}">
      <view class="action-btn disabled">
        <text>活动已结束</text>
      </view>
    </block>
    
    <!-- 进行中或即将开始的活动 -->
    <block wx:else>
      <block wx:if="{{!hasJoined}}">
        <view class="action-btn {{activity.isFull ? 'disabled' : ''}}" bindtap="joinActivity">
          <text>{{activity.isFull ? '已满员' : '立即报名'}}</text>
        </view>
      </block>
      <block wx:else>
        <view class="action-btn cancel" bindtap="cancelJoin">
          <text>取消报名</text>
        </view>
        <view class="action-btn check-in {{!canCheckIn ? 'disabled' : ''}} {{hasCheckedIn ? 'checked' : ''}}" 
              bindtap="{{canCheckIn ? 'toggleCheckIn' : ''}}">
          <text>{{!canCheckIn ? '未到签到时间' : (hasCheckedIn ? '已签到' : '签到')}}</text>
        </view>
      </block>
    </block>
  </view>
</view> 